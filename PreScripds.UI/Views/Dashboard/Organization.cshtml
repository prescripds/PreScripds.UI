@model PreScripds.UI.Models.OrganizationViewModel
@using PreScripds.UI.Common;
@using PreScripds.Domain;
@using PreScripds.Infrastructure;
@{
    ViewBag.Title = "Organization";
    Layout = "~/Views/Shared/_OpenLayout.cshtml";
}

<div class="col-md-12 blackBg">
    @using (Html.BeginForm("Organization", "Dashboard", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary()<br />
        <div class="validation-summary-errors" style="display:none" id="emailExistsDiv">
            <ul>
                <li class="success" id="userNameExists">
                </li>
            </ul>
        </div>

        <h4><span>Let Us Know You More.</span><hr /> </h4>
        <div class="row">
            <div class="col-md-4 col-sm-6">
                <div class="form-group">
                    <label class="control-label" for="FirstName">Organization Type*</label>
                    @Html.EnumDropDownListFor(m => m.OrganizationType, new { @class = "form-control" }, typeof(PreScripds.Domain.Enums.OrganizationType))
                    @Html.HiddenFor(x => x.OrganizationType, new { @id = "hdfOrgType" })
                </div>
            </div>
        </div>
        <hr />
        <div id="organizationDtlsN">
            <h4><span>Organization Details</span><hr /> </h4>
            <div class="row">
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="FirstName">Organization Name</label>
                        @Html.TextBoxFor(m => m.OrganizationName, new { @class = "form-control" })
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="LastName">Organization Address</label>
                        @Html.TextBoxFor(m => m.OrganizationAddress, new { @class = "form-control" })
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="MiddleName">Organization Phone</label>
                        @Html.TextBoxFor(m => m.OrganizationPhone, new { @class = "form-control" })
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="FirstName">Organization Mobile</label>
                        @Html.TextBoxFor(m => m.OrganizationMobile, new { @class = "form-control" })
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="LastName">Organization Email</label>
                        @Html.TextBoxFor(m => m.OrganizationEmail, new { @class = "form-control" })
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="MiddleName">Contact Person</label>
                        @Html.TextBoxFor(m => m.OrganizationContact, new { @class = "form-control" })
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="FirstName">Self Certification</label>
                        @Html.CheckBoxFor(m => m.IsSelfie, new { @tooltip = "Selfe" })
                    </div>
                </div>
            </div>
            <div class="row" id="noSelfie">
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="FirstName">Date for certification by us</label>
                        @Html.TextBoxFor(m => m.VerificationDate, new { @class = "form-control" })
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="LastName">Please @Html.ActionLink("Click Here", "CheckList", "Dashboard") to download the check list required during certification by us.</label>
                    </div>
                </div>
            </div>
            @*<div class="row" id="selfie" style="display:none">
                <div class="form-group">
                <p style="border: solid 1px #2FB73F; color: #2FB73F; padding: 5px; margin-right: 8%; margin-left: 1%;">By clicking on Self Approval, You have agreed to Self Approval terms &amp; conditions. Please contact us for further clarifications.</p>
                </div>
                </div>*@


            <div class="row">

            </div>
        </div>

        <div id="organizationDtlsE">
            <h4><span>Profile Details</span><hr /> </h4>
            <div class="row">
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="FirstName">Referenced Email</label>

                        @Html.TextBoxFor(m => m.ReferencedEmail, new { @class = "form-control" })
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="LastName">Organization Name</label>
                        @Html.TextBoxFor(m => m.OrganizationName, new { @class = "form-control" })
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="MiddleName">Department</label>
                        @Html.DropDownListFor(m => m.DepartmentId, Model.Department.ToSelectListItems(model => model.DepartmentId.ToString(), model => model.DepartmentName), "--Select--", new { @class = "form-control" })

                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="FirstName">Employee Id</label>
                        @*Check for EMPID starting if super Admin only*@
                        @Html.TextBoxFor(m => m.EmployeeIdOrg, new { @class = "form-control" })
                    </div>
                </div>
                <div class="col-md-4 col-sm-6">
                    <div class="form-group">
                        <label class="control-label" for="LastName">Designation</label>
                        @Html.TextBoxFor(m => m.Designation, new { @class = "form-control" })
                    </div>
                </div>
            </div>
        </div>
        <div class="row" id="buttons">
            <div class="col-md-12 buttons" style="margin-top:6px">
                <button type="submit" class="btn btn-warning pull-right" value="Save">Save</button>

                <button type="reset" class="btn btn-warning pull-right" value="Clear">Clear</button>
            </div>
        </div>
    }
    <div class="row" id="selfie" style="display: none; ">
        @using (Ajax.BeginForm("AddOrgDoc", "Dashboard", null, new AjaxOptions() { HttpMethod = "Post", InsertionMode = InsertionMode.Replace, UpdateTargetId = "divAddOrgDoc", OnSuccess = "ajaxFrmSuccess" }, new { id = "frmAddOrgDoc" }))
        {
            @Html.Partial("Partials/_OrganizationDocuments", Model.OrganizationDocumentViewModel)
            <div id="divAddOrgDoc">
            </div>
        }
    </div>
    @if (Model.OrganizationDocumentViewModels.IsCollectionValid())
    {
        <div class="row">
            <div class="col-md-12">
                <div class="table-container">
                    <div class="table-responsive">
                        <table width="100%" class="custom-table responsive">
                            <thead>
                                <tr class="header-tr">
                                    <th>
                                        Document Name
                                    </th>
                                    <th>
                                        Document Description
                                    </th>
                                    <th>
                                        Document
                                    </th>
                                    <th>@Html.Label("Action")</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < Model.OrganizationDocumentViewModels.Count; i++)
                                {
                                <tr>
                                    <td>
                                        <div class="ellipsis-div" title="@Model.OrganizationDocumentViewModels[i].OrganizationDocumentName">
                                            @* @Html.ActionLink(Model.PubSearchResult[i].Id.ToString(), "Pub", new { id = EncryptionExtensions.Encrypt(Model.PubSearchResult[i].Id.ToString()) })*@
                                            @Html.TextBoxFor(x => Model.OrganizationDocumentViewModels[i].OrganizationDocumentName)
                                            @Html.TextBoxFor(x => Model.OrganizationDocumentViewModels[i].OrganizationDocumentId, new { @class = "hidden" })
                                        </div>
                                    </td>
                                    <td>
                                        <div class="ellipsis-div" title="@Model.OrganizationDocumentViewModels[i].DocumentDescription">
                                            @Html.TextBoxFor(x => Model.OrganizationDocumentViewModels[i].DocumentDescription)
                                        </div>
                                    </td>
                                    <td>
                                        <div class="ellipsis-div" title="@Model.OrganizationDocumentViewModels[i].Document">

                                        </div>
                                    </td>
                                    <td>
                                        <div class="ellipsis-div" title="@Model.OrganizationDocumentViewModels[i].IsActive">
                                            @Html.TextBoxFor(x => Model.OrganizationDocumentViewModels[i].IsActive)
                                        </div>
                                    </td>
                                    <td class="linkedData">
                                        @*<a href="@Url.Action("Pub", "Pub", new { pubId = EncryptionExtensions.Encrypt(Model.PubSearchResult[i].Id.ToString()) })">
                                                <div class="edit-icon" title="edit"></div>
                                            </a>*@
                                </tr>
                                }


                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    }

</div>
@* if doc collectionvalid, redirect to timelineorg doc page. with next button which redirects to Addrole page if der is no role added.*@
@*@if (Model.OrganizationDocumentViewModels.IsCollectionValid())
    {
@Html.MessageDialogRedirect(Model.Message, "AddRole", "Dashboard", true)
}*@




@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {

            @*@Html.Iff(Model.CreationSuccessful, Html.Raw("$('#success-modal').modal('show');"))*@
            $('#IsSelfie').on('click', function () {
                var checked = $(this).is(':checked');
                if (checked) {
                    $('#noSelfie').attr('style', 'display:none');
                    $('#selfie').removeAttr('style');
                    $('#selfie').attr('style', 'border:1px solid white;padding:10px;');
                    $('#buttons').attr('style', 'display:none');
                }
                else {
                    $('#noSelfie').removeAttr('style');
                    $('#selfie').attr('style', 'display:none');
                    $('#buttons').removeAttr('style');
                }

            });
            //$(document.body).on('click', '#btnAddOrgDoc', function () {
            //    var $frm = $('#frmAddOrgDoc');
            //  //  $frm.submit();

            //});
            var orgVal = $('#OrganizationType').val();
            if (orgVal == "") {
                $('#organizationDtlsN').attr('style', 'display:none');
                $('#organizationDtlsE').attr('style', 'display:none');
                $('#buttons').attr('style', 'display:none');
            }
            if (orgVal == 1) {
                $('#organizationDtlsE').attr('style', 'display:none');
            }
            if (orgVal == 2) {
                $('#organizationDtlsN').attr('style', 'display:none');
            }
            $('#OrganizationType').on('change', function () {
                var orgType = $(this).val();
                $('hdfOrgType').val(orgType);
                if (orgType == 1) {
                    $('#organizationDtlsN').removeAttr('style');
                    $('#organizationDtlsE').attr('style', 'display:none');
                    $('#buttons').removeAttr('style');
                }
                if (orgType == 2) {
                    $('#organizationDtlsE').removeAttr('style');
                    $('#organizationDtlsN').attr('style', 'display:none');
                    $('#buttons').removeAttr('style');
                }
            });
        });

        window.ajaxFrmSuccess = function (htmlPartial) {
            //alert('success');
        };

    </script>
}